{% extends 'css-js-links.html' %}
{% load custom_filters %}

{% block title %}
Print Gatepass
{% endblock title %}

{% block context %}
{% if request.user.is_superuser %}
{% include 'navbar.html' %} 
{% else %}
{% include 'store/navbar.html' %} 
{% endif %}
{% endblock context %}


{% block body %}

<style>
	body {
		font-family: Arial, sans-serif;
	}

	.table-container {
		width: 60%;
		margin: 0 auto;
		border: 1px solid #000;
		padding: 20px;
	}

	table {
		width: 100%;
		border-collapse: collapse;
		margin-top: 10px;
	}

	th,
	td {
		border: 1px solid #000;
		padding: 8px;
		text-align: left;
	}

	.header-section {
		display: flex;
		justify-content: space-between;
		margin-bottom: 10px;
	}

	.footer-section {
		display: flex;
		justify-content: space-between;
		margin-top: 20px;
	}

	.col-1 {
		width: 5%;
	}

	.col-2 {
		width: 35%;
	}

	.col-3 {
		width: 10%;
	}

	.col-4 {
		width: 10%;
	}

	.col-5 {
		width: 15%;
	}

	.col-6 {
		width: 25%;
	}

	/* Print-specific styles */
	@media print {
		body * {
			visibility: hidden;
		}

		.printableArea,
		.printableArea * {
			visibility: visible;
		}

		.printableArea {
			position: absolute;
			left: 0;
			top: 0;
			width: 100%;
			margin: 0;
			padding: 5px;
		}
	}
</style>

<div class="pcoded-content">
	<div class="pcoded-inner-content">
		<div class="main-body">
			<div class="page-wrapper">
				<div class="page-body">
					<div class="table-container printableArea" id="printableArea">
						<h1 class="text-center bg-primary">Please Allow The Material Outside</h1>
						<div class="header-section">
							<div>
								<p>
									Returnable
									<input type="checkbox" value="True" {% if gatepass.returnable %}checked{% endif %} disabled> &nbsp;
									Nonreturnable
									<input type="checkbox" value="False" {% if not gatepass.returnable %}checked{% endif %} disabled>
								</p>
								<p><strong>Date:</strong> {{ gatepass.date_created|date:"d-m-Y" }}</p>
								<p><strong>Vehicle:</strong> {{ gatepass.vehicle }}</p>
								<p><strong>Time:</strong> {{ gatepass.date_created|time:"H:i" }}</p>
							</div>
							<div style="margin-right:50px">
								<p><strong>Dispatch For:</strong> {{ gatepass.dispatch_for }}</p>
								<p><strong>Name of Site:</strong> {{ gatepass.name_of_site }}</p>
								<p><strong>Per. Name:</strong> {{ gatepass.person_name }}</p>
								<p><strong>Ph. No:</strong> {{ gatepass.phone_number }}</p>
							</div>
						</div>
						<table>
							<thead>
								<tr>
									<th class="col-1 text-center">Sr#</th>
									<th class="col-2 text-center">Description</th>
									<th class="col-3 text-center">Qty.</th>
									<th class="col-4 text-center">Unit</th>
									<th class="col-5 text-center">Weight (Kgs)</th>
									<th class="col-6 text-center">Remarks</th>
								</tr>
							</thead>
							<tbody>
								{% for item in gatepass_products %}
								<tr>
									<td class=" text-center">{{ forloop.counter }}</td>
									<td>{{ item.product.productname }}</td>
									<td class=" text-center">{{ item.quantity }}</td>
									<td class=" text-center">{{ item.product.unit }}</td>
									<td class=" text-center">{{item.product.product_weight|multiply:item.quantity}}</td>
									<td class=" text-center">{{ item.remarks }}</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
						<div class="footer-section">
							<div>
								<p>Prepared By</p>
								<p>Name: {{request.user}}</p>
								<p>Sign: _______</p>
							</div>
							<div>
								<p>Authorized By</p>
								<p>Name: _______</p>
								<p>Sign: _______</p>
							</div>
							<div>
								<p>Received By</p>
								<p>Name: _______</p>
								<p>Sign: _______</p>
							</div>
						</div>
					</div>
					<div class="container mt-5 text-center mb-5">
						<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#printModal">
            Print
        </button>
						<a href="{% url 'list_gatepasses' %}" class="btn btn-warning">Cancel</a>
					</div>
				</div>
			</div>
		</div>
	</div>



<!-- Bootstrap Modal -->
<div class="modal fade" id="printModal" tabindex="-1" aria-labelledby="storePurchaseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="storePurchaseModalLabel">Gate Pass</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalContent">
                <!-- Content will be copied dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" onclick="printReceipt()">Print</button>
            </div>
        </div>
    </div>
</div>


<!-- Add Bootstrap JS (for modal) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
function printReceipt() {
    const printContents = document.getElementById('modalContent').innerHTML;
    const printWindow = window.open('', '_blank', 'width=900,height=700');
    printWindow.document.write(`
        <html>
            <head>
                <title>Print Receipt</title>
                <style>
                    body { font-family: Arial, sans-serif; }
                    .table-container {
                        width: 100%;
                        border: 1px solid #000;
                        padding: 20px;
                        background-color: #fff;
                    }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-top: 10px;
                    }
                    th, td {
                        border: 1px solid #000;
                        padding: 8px;
                        text-align: left;
                    }
                    .header-section {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 10px;
                    }
                    .footer-section {
                        display: flex;
                        justify-content: space-between;
                        margin-top: 20px;
                        margin-left: 20px;
                    }
                    .text-center { text-align: center; }
                </style>
            </head>
            <body>
                <div class="printableArea">${printContents}</div>
            </body>
        </html>
    `);

    printWindow.document.close();
    printWindow.focus();
    setTimeout(function () {
        printWindow.print();
        printWindow.close();
    }, 500);
}

// When modal opens, copy the printable area into the modal
document.getElementById('printModal').addEventListener('show.bs.modal', function () {
    const printableArea = document.getElementById('printableArea').innerHTML;
    document.getElementById('modalContent').innerHTML = printableArea;
});


</script>



	{% endblock body %}